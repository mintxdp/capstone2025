#!/usr/bin/env bash
# ========================================
# System Update and Cleanup Tool
# Part of your command suite
# ========================================

set -euo pipefail

# Load library helpers
LIB_DIR="$(dirname "$0")/../lib"
source "$LIB_DIR/utils.sh"
source "$LIB_DIR/logger.sh"

# ----------------------------------------
# Main Update Function
# ----------------------------------------
perform_update() {
  log_info "Starting system update..."

  if ! command -v apt-get &>/dev/null; then
    log_error "apt-get not found. This script supports Debian/Ubuntu systems only."
    exit 1
  fi

  sudo apt-get update -y
  sudo apt-get upgrade -y
  sudo apt-get dist-upgrade -y
  sudo apt-get autoremove -y
  sudo apt-get autoclean -y

  log_info "System packages updated and cleaned successfully."
}

# ----------------------------------------
# Optional: Kernel Cleanup
# ----------------------------------------
clean_old_kernels() {
  if dpkg -l | grep -q linux-image; then
    log_info "Cleaning old kernels..."
    sudo apt-get autoremove --purge -y
  fi
}

# ----------------------------------------
# Run Script
# ----------------------------------------
confirm "This will update and clean your system. Proceed?"
perform_update
clean_old_kernels
log_info "âœ… Update completed successfully."

